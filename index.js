(function(f,n,R,o,h,s,c,A){"use strict";const{FormRow:g,FormSection:b,FormDivider:k,FormText:v}=A.Forms,C=function(e,a){typeof s.showToast=="function"&&(s.showToast.length>=2?s.showToast(e,{type:a}):s.showToast(e))};function N(){const[,e]=n.React.useReducer(function(t){return t+1},0),a=function(){c.storage.unreadGuildsCount=0,C("Statistics reset","success"),e()};return n.React.createElement(n.React.Fragment,null,n.React.createElement(b,{title:"Statistics"},n.React.createElement(g,{label:"Total unread guilds marked as read",trailing:c.storage.unreadGuildsCount||0}),n.React.createElement(g,{label:"Reset Statistics",subLabel:"Clear the counter for marked guilds",leading:n.React.createElement(g.Icon,{source:h.getAssetIDByName("ic_refresh_24px")}),onPress:a})),n.React.createElement(k,null),n.React.createElement(b,{title:"Information"},n.React.createElement(v,null,"The Read-all plugin adds a button to the bottom tab bar that allows you to mark all servers and DMs as read with a single tap."),n.React.createElement(v,{style:{marginTop:8}},"If you don't see the button, please try restarting Discord.")))}c.storage.unreadGuildsCount??=0;const P=o.findByProps("getGuilds","getGuild"),D=o.findByProps("getChannel","getMutablePrivateChannels"),B=o.findByProps("getUnreadCount","hasUnread"),T=o.findByProps("markGuildAsRead","markChannelAsRead"),w=o.findByName("HeaderBar");o.findByName("AppHeaderIcon")||o.findByProps("AppHeaderIcon")?.AppHeaderIcon;const G=o.findByProps("HeaderBarButton"),E=o.findByName("TopNavigation")||o.findByProps("TopNavigation")?.TopNavigation;let d=null,y=!0;function I(){try{const e=[],a=Object.values(P.getGuilds());for(const r of a)B.hasUnread(r.id)&&(e.push(r.id),T.markGuildAsRead(r.id));const t=Object.values(D.getMutablePrivateChannels());for(const r of t)B.hasUnread(r.id)&&T.markChannelAsRead(r.id);c.storage.unreadGuildsCount=(c.storage.unreadGuildsCount||0)+e.length,y&&(s.showToast(`Marked ${e.length} guilds as read`,l("success")),y=!1,setTimeout(function(){return y=!0},2e3))}catch(e){console.error("Error in markAllAsRead:",e),s.showToast("Failed to mark all as read",l("error"))}}function l(e){try{return typeof s.showToast=="function"?s.showToast.length>=2?{type:e}:{content:e}:{}}catch{return{}}}const u=function(){const e=G?.HeaderBarButton;return e?n.React.createElement(e,{onPress:I,icon:h.getAssetIDByName("ic_done_all_24px")||h.getAssetIDByName("ic_check_24px"),activeOpacity:.3,style:{marginRight:8},accessibilityLabel:"Mark all as read"}):(console.error("HeaderBarButton not found"),null)};var M={onLoad:function(){try{w?(d=R.after("default",w,function(e,a){try{const t=p(a,function(r){return r?.props?.children?.find?.(function(i){return i?.props?.accessibilityLabel==="New Group DM"||i?.props?.accessibilityLabel==="Direct Messages"})});if(t?.props?.children){const r=t.props.children.findIndex(function(i){return i?.props?.accessibilityLabel==="Direct Messages"});r!==-1?t.props.children.splice(r+1,0,n.React.createElement(u)):t.props.children.push(n.React.createElement(u))}}catch(t){console.error("Error patching HeaderBar:",t)}return a}),console.log("Successfully patched HeaderBar"),s.showToast("Read-all plugin loaded",l("success"))):E?(d=R.after("default",E,function(e,a){try{const t=p(a,function(r){return Array.isArray(r?.props?.children)&&r.props.children.some(function(i){return i?.props?.accessibilityLabel==="Direct Messages"})});if(t?.props?.children){const r=t.props.children.findIndex(function(i){return i?.props?.accessibilityLabel==="Direct Messages"});r!==-1?t.props.children.splice(r+1,0,n.React.createElement(u)):t.props.children.push(n.React.createElement(u))}}catch(t){console.error("Error patching TopNavigation:",t)}return a}),console.log("Using fallback TopNavigation patch"),s.showToast("Read-all plugin loaded",l("success"))):(console.error("Could not find any navigation components to patch"),s.showToast("Read-all plugin may not work correctly",l("warning")))}catch(e){console.error("Error during plugin load:",e),s.showToast("Read-all plugin failed to load correctly",l("error"))}},onUnload:function(){d&&d(),s.showToast("Read-all plugin unloaded",l("info"))},settings:N};function p(e,a){if(a(e))return e;if(e?.props?.children)if(Array.isArray(e.props.children))for(const t of e.props.children){const r=p(t,a);if(r)return r}else{const t=p(e.props.children,a);if(t)return t}return null}return f.default=M,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.common,vendetta.patcher,vendetta.metro,vendetta.ui.assets,vendetta.ui.toasts,vendetta.plugin,vendetta.ui.components);
